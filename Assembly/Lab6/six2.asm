;程序名：six2
;作者：胡超
;功能：编写一个接管键盘中断的中断服务程序并驻留内存
.386
STACK	SEGMENT	USE16
	DB	200	DUP(0)
STACK	ENDS
DATA	SEGMENT	USE16
DATA	ENDS
CODE	SEGMENT	USE16
	ASSUME	CS:CODE,DS:DATA,SS:STACK
OLD_INT	DW	?,?
NEW16H:
	PUSHF
	CALL	DWORD	PTR	OLD_INT
	CMP	AL,'a'
	JE	INPUT_a
	CMP	AL,'b'
	JE	INPUT_b
	CMP	AL,'A'
	JE	INPUTA
	CMP	AL,'B'
	JE	INPUTB
EX:	IRET
INPUT_a:
	MOV	AL,'b'
	JMP	EX
INPUT_b:
	MOV	AL,'a'
	JMP	EX
INPUTA:
	MOV	AL,'B'
	JMP	EX
INPUTB:
	MOV	AL,'A'
	JMP	EX
	
START:	
	XOR	AX,AX
	MOV	DS,AX
	MOV	AX,DS:[16H*4]
	MOV	OLD_INT,AX
	MOV	AX,DS:[16H*4+2]
	MOV	OLD_INT+2,AX
	CLI
	MOV	WORD	PTR	DS:[16H*4],OFFSET	NEW16H
	MOV	DS:[16H*4+2],CS
	STI
	MOV	DX,OFFSET	START+15
	MOV	CL,4
	SHR	DX,CL
	ADD	DX,10H
	MOV	AL,0
	MOV	AH,31H
	INT 21H
CODE	ENDS
	END	START